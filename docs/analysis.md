# vibe-local 実装解析レポート

> 解析日: 2026-02-23 | 対象バージョン: v0.9.4 (vibe-coder)

## 1. プロジェクト概要

vibe-local は、ローカルLLM（Ollama）を使ってオフライン環境で動作する完全無料・完全OSSのAIコーディングエージェントである。Python標準ライブラリのみで実装されており、外部パッケージへの依存がゼロという特徴を持つ。教育・研究目的で設計され、ネットワーク不要で動作する。

### コード規模

| ファイル | 行数 | 役割 |
|---------|------|------|
| vibe-coder.py | 5,650行 | メインエージェントエンジン |
| anthropic-ollama-proxy.py | 1,519行 | v0.2互換プロキシ（レガシー） |
| test_vibe_coder.py | 6,919行 | テストスイート |
| install.sh / install.ps1 | 約49K / 35K | クロスプラットフォームインストーラ |
| vibe-local.sh / vibe-local.ps1 | 約10K / 10K | ランチャースクリプト |

## 2. 機能一覧（何ができるか）

### 2.1 コアエージェント機能

- **対話型コーディング**: ユーザーと自然言語で会話しながらコードを生成・実行・修正
- **ワンショットモード**: `-p` フラグで単発の質問・タスク実行
- **セッション管理**: JSONL形式で会話を永続化し、`--resume` で再開可能
- **コンテキスト圧縮**: サイドカーモデルによる会話要約で長時間セッションに対応

### 2.2 内蔵ツール（15種）

| カテゴリ | ツール名 | 機能 |
|---------|---------|------|
| 実行系 | Bash | シェルコマンド実行（バックグラウンド対応、危険パターン検出） |
| ファイル操作 | Read | テキスト・画像・PDF・Jupyter読み込み |
| | Write | アトミック書き込み（10MB制限、アンドゥ対応） |
| | Edit | 文字列置換による編集（symlink保護） |
| 検索系 | Glob | ファイルパターン検索（mtime順、最大500件） |
| | Grep | 正規表現検索（ReDoS保護、コンテキスト行対応） |
| Web系 | WebFetch | HTTP取得（SSRF保護、HTML→テキスト変換） |
| | WebSearch | DuckDuckGo検索（標準ライブラリのみ、レート制限付き） |
| ノートブック | NotebookEdit | Jupyterセル操作（挿入・置換・削除） |
| タスク管理 | TaskCreate/List/Get/Update | インメモリタスク追跡（最大200件） |
| 対話 | AskUserQuestion | ユーザーへの質問（選択肢対応） |
| 拡張 | SubAgent | サブエージェント生成（別スレッド、最大20ターン） |

### 2.3 マルチモーダル対応

- **画像**: PNG/JPG/GIF をbase64エンコードしてビジョンモデルに送信
- **PDF**: 標準ライブラリのみでテキスト抽出（FlateDecode対応、ページ指定可）
- **Jupyter**: .ipynb ファイルの読み書き・セル編集

### 2.4 デュアルモデルルーティング

| モデル | 用途 | 例 |
|-------|------|-----|
| メインモデル | コーディング・ツール実行 | qwen3-coder:30b, qwen3:8b |
| サイドカーモデル | 権限チェック・要約・初期化 | qwen3:8b, qwen3:1.7b |

メモリ量に応じて自動選択される仕組み（32GB→30b+8b、16GB→8b+1.7b、8GB→1.7b単体）。

### 2.5 セキュリティ機構

- **パーミッションマネージャ**: safe/ask/deny の3段階。Bashの危険パターン（`rm -rf /`, `sudo`, `mkfs`）は `-y` モードでも常に確認
- **SSRF防御**: WebFetchでプライベートIP・リダイレクト先を検証
- **アトミック書き込み**: tempfile + os.replace() でファイル破損防止
- **環境変数サニタイズ**: GITHUB_TOKEN等のシークレットをsubprocessから除外
- **symlink保護**: Write/Editでシンボリックリンクへの書き込みを拒否
- **ReDoS防御**: Grepでネスト量指定子を禁止、パターン長制限

### 2.6 クロスプラットフォーム対応

- macOS（Apple Silicon推奨）、Windows（ネイティブ + WSL2）、Linux
- OS固有のヒントをシステムプロンプトに注入（brew/winget/apt 等）
- Windows: ANSI/VT処理の有効化、パス処理、PowerShellインストーラ
- CJK文字幅対応のターミナル表示

### 2.7 XMLフォールバック

Qwenモデルがfunction callingではなくXMLでツール呼び出しを返す場合、3パターンのXML構文を解析して正規化する互換レイヤー。

### 2.8 その他の機能

- **マルチ言語UI**: 日本語・英語・中国語（やさしい日本語も含む）
- **マークダウンレンダリング**: TUIでのコードブロック・テーブル表示
- **複数行入力**: `"""` で長文入力
- **自動ネットワーク判定**: `--auto` でオンラインならClaude API、オフラインならローカル
- **ループ検出**: 同一ツール呼び出し3回繰り返しで停止
- **パラレル実行**: 読み取り専用ツールはThreadPoolExecutor（4ワーカー）で並列実行

## 3. メリット

### 3.1 完全オフライン・完全無料

最大の差別化要因。インターネット接続もAPIキーもサブスクリプションも不要。教育機関や途上国の学生が無料でAIコーディングを体験できる。

### 3.2 ゼロ依存のシングルファイル構成

Python標準ライブラリのみで5,650行のエージェントが完結している。`pip install` すら不要。これにより、環境構築のトラブルが最小化され、インストールスクリプト1行で動作可能。

### 3.3 プロダクショングレードのセキュリティ

SSRF防御、危険コマンド検出、環境変数サニタイズ、symlink保護、アトミック書き込み、ReDoS防御、リクエストサイズ制限（50MB）など、防御的プログラミングが全面的に実装されている。教育用途でありながらセキュリティが犠牲にされていない。

### 3.4 堅牢なエラー処理

マルフォームJSON復旧（ast.literal_eval + トレーリングカンマ除去）、ストリーミング中断時のクリーンアップ、Ctrl+C後のtool_call/result整合性維持、空レスポンスのリトライなど、ローカルLLMの不安定さを想定した防御策が充実。

### 3.5 教育向け設計

やさしい日本語でのドキュメント、3ステップインストール、危険コマンドの警告表示、ワークショップ運用を意識したパーミッション設計。AIコーディングの敷居を下げることに成功している。

### 3.6 充実したテスト

テストコード（6,919行）がプロダクションコード（5,650行）を上回る。500以上のテストケースにより品質が担保されている。

### 3.7 洗練されたアーキテクチャ

デュアルモデルルーティング、サブエージェント、コンテキスト圧縮、XMLフォールバック、パラレルツール実行など、Claude Codeのような商用ツールと同等のアーキテクチャを持つ。

## 4. デメリット・課題

### 4.1 ローカルLLMの品質限界

ローカルの8B/30Bモデルは、Claude SonnetやGPT-4oと比較してコード生成の正確性・複雑なタスクの遂行能力で大きく劣る。ROADMAPにも記載されている通り、不要な説明の付加、毎回フォローアップ質問を行う、コマンド実行を指示するだけで自分では実行しない、などの品質問題が残存している。

### 4.2 ハードウェア要件

推奨環境はApple Silicon 32GB RAM + qwen3-coder:30bだが、これは一般的な学生や教育機関のPCスペックを超えている。8GBの最低限動作モードでは1.7bモデルしか使えず、実用性が大幅に低下する。

### 4.3 レスポンス速度

30Bモデルでのファイル書き込みに30〜46秒、サイドカーの初回起動に18.5秒かかる。クラウドAPIと比較して大幅に遅く、インタラクティブなコーディング体験を損ねる可能性がある。

### 4.4 シングルファイルの保守性

5,650行のモノリシックファイルは、読解・保守・拡張が困難。クラス・関数が1ファイルに密集しており、大規模なリファクタリングやモジュール分割が将来的に必要になる可能性がある。

### 4.5 Web機能の制限

WebSearchはDuckDuckGoのHTMLスクレイピングに依存しており、レート制限（セッション50回）やCAPTCHAでブロックされるリスクがある。オフライン環境では当然使えず、ローカルLLMがURLを捏造する問題がv0.2で発生（v0.2.xで修正済み）していた。

### 4.6 未実装機能

ROADMAPによると、サブエージェント/タスクツール（一部実装）、プランモードが未完成。また、ツール使用の多様性が低く（Bash/Writeに偏重）、Read/Glob/Grepが十分活用されていない。

### 4.7 言語混在の問題

ローカルLLMの特性として、日本語応答中に中国語の文字が混入する問題がROADMAPで報告されている。多言語モデルの宿命的な課題で、プロンプトだけでは完全には解決困難。

### 4.8 stdin制限

Bashツール経由でのコマンド実行では `input()` が使えない（EOFError）。対話型スクリプトの実行にはGUIへの書き換えが必要で、初学者にとって混乱の原因になりうる。

## 5. 競合との比較

| 特徴 | vibe-local | Claude Code | GitHub Copilot | Cursor |
|------|-----------|-------------|----------------|--------|
| 料金 | 無料 | 有料（API課金） | 有料（月額） | 有料（月額） |
| オフライン | 対応 | 不可 | 不可 | 不可 |
| OSS | 完全OSS | 一部OSS | 非公開 | 非公開 |
| LLM品質 | ローカル（8B-30B） | Claude Sonnet/Opus | GPT-4o | 複数モデル |
| セットアップ | 1コマンド | アカウント要 | IDE連携 | IDE必須 |
| ツール数 | 15 | 20+ | N/A | N/A |
| 教育用途 | 最適化済み | 汎用 | 汎用 | 汎用 |

## 6. 総合評価

vibe-local は「無料でオフラインで使えるAIコーディングエージェント」というニッチを的確に突いたプロジェクトである。Python標準ライブラリのみで商用ツール並みのアーキテクチャを実現している点は技術的に高い評価に値する。セキュリティ・堅牢性・テストカバレッジも本格的で、教育用途のOSSとしては異例の完成度である。

一方で、ローカルLLMの品質限界・ハードウェア要件・レスポンス速度という本質的な制約があり、商用ツールの代替にはなりえない。教育・ワークショップ・オフライン環境という想定用途においてこそ真価を発揮するツールであり、その領域ではほぼ唯一の実用的な選択肢と言える。

### 推奨ユースケース

- 教育機関でのプログラミングワークショップ
- AIコーディングエージェントの仕組みを学ぶ教材
- ネットワーク制限環境での開発補助
- 有料プランに加入できない学生のAIコーディング体験

### 非推奨ユースケース

- プロダクションコードの本格的な開発
- 高い精度を要求されるタスク
- リアルタイムの高速レスポンスが必要な場面
